<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dice Arena PRO Modular</title>
<style>
body {
    background:#0f1220;
    color:white;
    font-family:Arial;
    text-align:center;
}
.container {
    width:90%;
    max-width:900px;
    margin:auto;
}
.top {
    margin:10px 0;
}
input, select {
    margin:5px;
    padding:4px;
}
.botones button {
    margin:5px;
    padding:6px 12px;
    cursor:pointer;
    border:none;
    border-radius:6px;
    background:#2b6cff;
    color:white;
}
.botones button:hover {
    background:#4a85ff;
}
#tabla {
    background:#161a2e;
    border:1px solid #333;
    padding:10px;
    height:220px;
    overflow:auto;
    font-family:monospace;
    margin-top:10px;
}
#lider {
    font-size:1.2em;
    font-weight:bold;
    margin-top:10px;
}
canvas {
    margin-top:10px;
    background:#161a2e;
    border:1px solid #333;
}
.menuModo {
    margin:10px 0;
    display:none;
}
</style>
</head>
<body>
<div class="container">
<h2>Dice Arena PRO Modular</h2>

<!-- Selector de modo -->
<div class="top">
Modo:
<select id="modo" onchange="mostrarMenu()">
  <option value="normal">Normal</option>
  <option value="versus">Versus</option>
  <option value="equipos">Equipos</option>
  <option value="torneo">Torneo</option>
</select>
</div>

<!-- Menú general -->
<div id="menu-normal" class="menuModo">
Jugadores <input id="players" type="number" value="2" min="2">
Min <input id="min" type="number" value="1">
Max <input id="max" type="number" value="6">
Velocidad(ms) <input id="velocidad" type="number" value="500">
Limite rondas <input id="limite" type="number" value="0">
<button onclick="configurar()">Configurar</button>
<button onclick="iniciarAuto()">Auto</button>
<button onclick="detenerAuto()">Detener</button>
</div>

<div id="menu-versus" class="menuModo">
Rondas <input id="rondas-versus" type="number" value="5" min="1">
Velocidad(ms) <input id="velocidad-versus" type="number" value="500">
<button onclick="configurarVersus()">Configurar Versus</button>
<button onclick="iniciarAutoVersus()">Iniciar Versus</button>
<button onclick="detenerAuto()">Detener</button>
</div>

<div id="menu-equipos" class="menuModo">
Jugadores <input id="players-equipos" type="number" value="4" min="2">
Número de equipos <input id="num-equipos" type="number" value="2" min="2">
<button onclick="crearEquipos()">Crear Equipos</button>
<div id="inputs-equipos"></div>
<button onclick="iniciarAutoEquipos()">Iniciar Equipos</button>
<button onclick="detenerAuto()">Detener</button>
</div>

<div id="menu-torneo" class="menuModo">
Jugadores <input id="players-torneo" type="number" value="4" min="2">
Velocidad(ms) <input id="velocidad-torneo" type="number" value="500">
Limite rondas <input id="limite-torneo" type="number" value="0">
<button onclick="configurarTorneo()">Configurar Torneo</button>
<button onclick="iniciarAutoTorneo()">Iniciar Torneo</button>
<button onclick="detenerAuto()">Detener</button>
</div>

<div id="nombres"></div>

<div class="botones">
<button onclick="agregarRonda()">Ronda</button>
<button onclick="mensajeRonda()">Decir ganador ronda</button>
<button onclick="finalizarPartida()">Finalizar partida</button>
<button onclick="reset()">Reset</button>
</div>

<h3 id="lider"></h3>
<h3 id="info"></h3>
<h3 id="prob" style="display:none;"></h3>
<p id="mensaje"></p>

<canvas id="grafica" height="120"></canvas>
<div id="tabla"></div>

</div>

<script>
let jugadores=[], puntos=[], colores=[], ultimoGanador=null, intervalo=null, rondas=0, mostrarProb=false;

// --- CONECTOR PARA FUTURAS FUNCIONES ---
// Aquí puedes pegar nuevas funciones o botones sin romper nada del código

function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function colorRandom(){ return "hsl(" + Math.floor(Math.random()*360) + ",70%,60%)"; }

function mostrarMenu(){
    document.querySelectorAll(".menuModo").forEach(m => m.style.display="none");
    const modo=document.getElementById("modo").value;
    document.getElementById("menu-"+modo).style.display="block";
}

function configurar(){
    let n=parseInt(document.getElementById("players").value);
    inicializarJugadores(n);
}

function configurarVersus(){
    let n=2;
    inicializarJugadores(n);
}

function configurarTorneo(){
    let n=parseInt(document.getElementById("players-torneo").value);
    inicializarJugadores(n);
}

function crearEquipos(){
    let n=parseInt(document.getElementById("players-equipos").value);
    let numEquipos=parseInt(document.getElementById("num-equipos").value);
    inicializarJugadores(n);
    // Aquí generamos inputs para nombres de jugadores
    let cont=document.getElementById("inputs-equipos");
    cont.innerHTML="";
    jugadores.forEach((j,i)=>{
        let input=document.createElement("input");
        input.value=j;
        input.oninput=(e)=>jugadores[i]=e.target.value;
        cont.appendChild(input);
    });
}

function inicializarJugadores(n){
    jugadores=[]; puntos=[]; colores=[]; rondas=0;
    let cont=document.getElementById("nombres");
    cont.innerHTML="";
    for(let i=0;i<n;i++){
        jugadores.push("J"+(i+1));
        puntos.push(0);
        colores.push(colorRandom());
        let input=document.createElement("input");
        input.value=jugadores[i];
        input.oninput=(e)=>jugadores[i]=e.target.value;
        cont.appendChild(input);
    }
    document.getElementById("tabla").innerHTML="";
    actualizarInfo();
    dibujarGrafica();
}

function agregarRonda(){
    let min=parseInt(document.getElementById("min")?.value || 1);
    let max=parseInt(document.getElementById("max")?.value || 6);
    let limite=parseInt(document.getElementById("limite")?.value || 0);
    if(limite>0 && rondas>=limite){ detenerAuto(); finalizarPartida(); return; }

    let valores=[]; let mayor=-Infinity;
    for(let i=0;i<jugadores.length;i++){
        let v=rand(min,max);
        valores.push(v);
        if(v>mayor) mayor=v;
    }
    let ganadores=[];
    valores.forEach((v,i)=>{ if(v===mayor){ puntos[i]++; ganadores.push(i); } });
    ultimoGanador=ganadores[0];
    rondas++;

    let fila=document.createElement("div");
    valores.forEach((v,i)=>{
        let span=document.createElement("span");
        span.style.color=colores[i];
        span.textContent=jugadores[i]+":"+v+" ";
        if(v===mayor) span.style.fontWeight="bold";
        fila.appendChild(span);
    });
    document.getElementById("tabla").appendChild(fila);
    document.getElementById("tabla").scrollTop=99999;
    actualizarInfo();
    dibujarGrafica();
}

function actualizarInfo(){
    let texto="Rondas: "+rondas+" | ";
    let maxP=Math.max(...puntos);
    let lideres=[];
    puntos.forEach((p,i)=>{
        texto+=jugadores[i]+":"+p+" ";
        if(p===maxP) lideres.push(jugadores[i]);
    });
    document.getElementById("info").innerText=texto;
    document.getElementById("lider").innerText="Lider: "+lideres.join(", ");
    if(mostrarProb){
        let probTexto="";
        puntos.forEach((p,i)=>{ let pr=rondas>0?((p/rondas)*100).toFixed(1):0; probTexto+=jugadores[i]+": "+pr+"% "; });
        document.getElementById("prob").innerText=probTexto;
    }
}

function mensajeRonda(){ if(ultimoGanador===null) return; let texto=document.getElementById("textoGanador").value; document.getElementById("mensaje").innerText=jugadores[ultimoGanador]+" "+texto+" la ronda"; }
function finalizarPartida(){ let maxP=Math.max(...puntos); let ganador=puntos.indexOf(maxP); let texto=document.getElementById("textoGanador").value; document.getElementById("mensaje").innerText=jugadores[ganador]+" "+texto+" la partida"; }

function iniciarAuto(){ if(intervalo) return; let vel=parseInt(document.getElementById("velocidad")?.value || 500); intervalo=setInterval(agregarRonda,vel); }
function iniciarAutoVersus(){ if(intervalo) return; let vel=parseInt(document.getElementById("velocidad-versus").value); intervalo=setInterval(agregarRonda,vel); }
function iniciarAutoEquipos(){ if(intervalo) return; let vel=parseInt(document.getElementById("velocidad")?.value || 500); intervalo=setInterval(agregarRonda,vel); }
function iniciarAutoTorneo(){ if(intervalo) return; let vel=parseInt(document.getElementById("velocidad-torneo").value); intervalo=setInterval(agregarRonda,vel); }

function detenerAuto(){ clearInterval(intervalo); intervalo=null; }
function toggleProb(){ mostrarProb=!mostrarProb; document.getElementById("prob").style.display=mostrarProb?"block":"none"; actualizarInfo(); }
function dibujarGrafica(){ const canvas=document.getElementById("grafica"); const ctx=canvas.getContext("2d"); ctx.clearRect(0,0,canvas.width,canvas.height); let maxP=Math.max(...puntos,1); let ancho=canvas.width/jugadores.length; puntos.forEach((p,i)=>{ let alto=(p/maxP)*canvas.height; ctx.fillStyle=colores[i]; ctx.fillRect(i*ancho,canvas.height-alto,ancho-4,alto); }); }
function reset(){ detenerAuto(); configurar(); }

mostrarMenu(); // Para mostrar el menú inicial al cargar la página
configurar(); // Configuración inicial de jugadores normales
</script>
