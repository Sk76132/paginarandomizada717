<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dice Arena - Modo Estándar</title>
<style>
body {
    background:#0f1220;
    color:white;
    font-family:Arial;
    text-align:center;
}
.container {
    width:90%;
    max-width:900px;
    margin:auto;
}
.top {
    margin:10px 0;
}
input {
    margin:5px;
    padding:4px;
}
button {
    margin:5px;
    padding:8px 16px;
    cursor:pointer;
    border:none;
    border-radius:6px;
}
button.gris {
    background:#888;
    color:white;
}
button.gris:hover {
    background:#aaa;
}
#tabla {
    background:#161a2e;
    border:1px solid #333;
    padding:10px;
    height:220px;
    overflow:auto;
    font-family:monospace;
    margin-top:10px;
}
#lider {
    font-size:1.2em;
    font-weight:bold;
    margin-top:10px;
}
canvas {
    margin-top:10px;
    background:#161a2e;
    border:1px solid #333;
}
</style>
</head>
<body>
<div class="container">
<h2>Dice Arena - Modo Estándar</h2>

<div class="top">
Jugadores <input id="players" type="number" value="2" min="2">
Min <input id="min" type="number" value="1">
Max <input id="max" type="number" value="6">
Velocidad(ms) <input id="velocidad" type="number" value="500">
Limite rondas <input id="limite" type="number" value="0">
</div>

<div id="nombres"></div>

<!-- Botón gris que ejecuta toda la ronda y muestra resultados -->
<button class="gris" onclick="ejecutarRondaCompleta()">Ejecutar Ronda</button>

<h3 id="lider"></h3>
<h3 id="info"></h3>
<h3 id="prob" style="display:none;"></h3>
<p id="mensaje"></p>

<canvas id="grafica" height="120"></canvas>
<div id="tabla"></div>

</div>

<script>
// --- VARIABLES PRINCIPALES ---
let jugadores = [], puntos = [], colores = [], ultimoGanador = null, rondas = 0;
let mostrarProb = false;
let intervalo = null;

// --- CONECTOR PARA FUTURAS FUNCIONES ---
// --- AQUI PUEDES PEGAR FUNCIONES NUEVAS ---
console.log("CONECTOR AQUÍ → pegar nuevas funciones debajo de este comentario");

// --- FUNCIONES AUXILIARES ---
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function colorRandom(){ return "hsl(" + Math.floor(Math.random()*360) + ",70%,60%)"; }

// --- CONFIGURACIÓN DE JUGADORES ---
function configurar(){
    let n = parseInt(document.getElementById("players").value);
    jugadores = [];
    puntos = [];
    colores = [];
    rondas = 0;
    let cont = document.getElementById("nombres");
    cont.innerHTML = "";
    for(let i=0;i<n;i++){
        jugadores.push("J"+(i+1));
        puntos.push(0);
        colores.push(colorRandom());
        let input=document.createElement("input");
        input.value=jugadores[i];
        input.oninput=(e)=>jugadores[i]=e.target.value;
        cont.appendChild(input);
    }
    document.getElementById("tabla").innerHTML="";
    actualizarInfo();
    dibujarGrafica();
}

// --- EJECUTAR RONDA COMPLETA ---
function ejecutarRondaCompleta(){
    let min = parseInt(document.getElementById("min").value);
    let max = parseInt(document.getElementById("max").value);
    let limite = parseInt(document.getElementById("limite").value);
    if(limite>0 && rondas>=limite){ finalizarPartida(); return; }

    let valores = [], mayor = -Infinity;
    for(let i=0;i<jugadores.length;i++){
        let v = rand(min,max);
        valores.push(v);
        if(v>mayor) mayor=v;
    }

    let ganadores = [];
    valores.forEach((v,i)=>{
        if(v===mayor){ puntos[i]++; ganadores.push(i); }
    });
    ultimoGanador = ganadores[0];
    rondas++;

    // Mostrar resultados en tabla
    let fila = document.createElement("div");
    valores.forEach((v,i)=>{
        let span=document.createElement("span");
        span.textContent=jugadores[i]+":"+v+" ";
        span.style.color=colores[i];
        if(v===mayor) span.style.fontWeight="bold";
        fila.appendChild(span);
    });
    document.getElementById("tabla").appendChild(fila);
    document.getElementById("tabla").scrollTop=99999;

    actualizarInfo();
    dibujarGrafica();
}

// --- ACTUALIZAR INFORMACIÓN ---
function actualizarInfo(){
    let texto = "Rondas: "+rondas+" | ";
    let maxP = Math.max(...puntos);
    let lideres = [];
    puntos.forEach((p,i)=>{
        texto += jugadores[i]+":"+p+" ";
        if(p===maxP) lideres.push(jugadores[i]);
    });
    document.getElementById("info").innerText = texto;
    document.getElementById("lider").innerText = "Lider: "+lideres.join(", ");

    if(mostrarProb){
        let probTexto="";
        puntos.forEach((p,i)=>{
            let pr=rondas>0?((p/rondas)*100).toFixed(1):0;
            probTexto += jugadores[i]+": "+pr+"% ";
        });
        document.getElementById("prob").innerText = probTexto;
    }
}

// --- MENSAJES DE GANADOR ---
function mensajeRonda(){ 
    if(ultimoGanador===null) return;
    document.getElementById("mensaje").innerText = jugadores[ultimoGanador]+" ha ganado la ronda";
}

function finalizarPartida(){
    let maxP=Math.max(...puntos);
    let ganador=puntos.indexOf(maxP);
    document.getElementById("mensaje").innerText = jugadores[ganador]+" ha ganado la partida";
}

// --- GRAFICA ---
function dibujarGrafica(){
    const canvas=document.getElementById("grafica");
    const ctx=canvas.getContext("2d");
    ctx.clearRect(0,0,canvas.width,canvas.height);
    let maxP=Math.max(...puntos,1);
    let ancho=canvas.width/jugadores.length;
    puntos.forEach((p,i)=>{
        let alto=(p/maxP)*canvas.height;
        ctx.fillStyle=colores[i];
        ctx.fillRect(i*ancho,canvas.height-alto,ancho-4,alto);
    });
}

// --- REINICIAR ---
function reset(){
    configurar();
}

// --- INICIALIZACIÓN ---
configurar();
</script>
