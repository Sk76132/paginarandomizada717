<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dice Arena - Simulador PRO</title>
  <style>
    body{
        background:#0f1220;
        color:white;
        font-family:Arial;
        text-align:center;
    }

    .container{
        width:90%;
        max-width:900px;
        margin:auto;
    }

    .top{
        margin:10px 0;
    }

    input, select{
        margin:5px;
        padding:4px;
    }

    .botones button{
        margin:5px;
        padding:6px 12px;
        cursor:pointer;
        border:none;
        border-radius:6px;
        background:#2b6cff;
        color:white;
    }

    .botones button:hover{
        background:#4a85ff;
    }

    #tabla{
        background:#161a2e;
        border:1px solid #333;
        padding:10px;
        height:220px;
        overflow:auto;
        font-family:monospace;
        margin-top:10px;
    }

    #lider{
        font-size:1.2em;
        font-weight:bold;
        margin-top:10px;
    }

    canvas{
        margin-top:10px;
        background:#161a2e;
        border:1px solid #333;
    }
  </style>
</head>
<body>
<div class="container">

<h2>Dice Arena - Simulador PRO</h2>

<div class="top">
Jugadores <input id="players" type="number" value="2" min="2">
Min <input id="min" type="number" value="1">
Max <input id="max" type="number" value="6">
Velocidad(ms) <input id="velocidad" type="number" value="500">
Limite rondas <input id="limite" type="number" value="0">
<button onclick="configurar()">Configurar</button>
<button onclick="iniciarAuto()">Auto</button>
<button onclick="detenerAuto()">Detener</button>
</div>

<div id="nombres"></div>

<div class="top">
Modo:
<select id="modo">
  <option value="ffa">Todos vs Todos</option>
  <option value="versus">1 vs 1</option>
  <option value="equipos">Equipos</option>
  <option value="torneo">Torneo</option>
</select>
<br>
Texto ganador:
<input id="textoGanador" value="ha ganado">
<button onclick="toggleProb()">Mostrar/ocultar probabilidades</button>
</div>

<div class="botones">
<button onclick="agregarRonda()">Ronda</button>
<button onclick="mensajeRonda()">Decir ganador ronda</button>
<button onclick="finalizarPartida()">Finalizar partida</button>
<button onclick="modoTorneo()">Modo torneo</button>
<button onclick="reset()">Reset</button>
</div>

<h3 id="lider"></h3>
<h3 id="info"></h3>
<h3 id="prob" style="display:none;"></h3>
<p id="mensaje"></p>

<canvas id="grafica" height="120"></canvas>

<div id="tabla"></div>

</div>

<script>
let jugadores = [];
let puntos = [];
let colores = [];
let ultimoGanador = null;
let intervalo = null;
let rondas = 0;
let mostrarProb = false;

const canvas = document.getElementById("grafica");
const ctx = canvas.getContext("2d");

function rand(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
}

function colorRandom(){
    return "hsl(" + Math.floor(Math.random()*360) + ",70%,60%)";
}

function configurar(){
    let n = parseInt(document.getElementById("players").value);
    jugadores=[];
    puntos=[];
    colores=[];
    rondas=0;

    let cont=document.getElementById("nombres");
    cont.innerHTML="";

    for(let i=0;i<n;i++){
        jugadores.push("J"+(i+1));
        puntos.push(0);
        colores.push(colorRandom());

        let input=document.createElement("input");
        input.value=jugadores[i];
        input.oninput=(e)=>jugadores[i]=e.target.value;
        cont.appendChild(input);
    }

    document.getElementById("tabla").innerHTML="";
    actualizarInfo();
    dibujarGrafica();
}

function agregarRonda(){
    let limite=parseInt(document.getElementById("limite").value);
    if(limite>0 && rondas>=limite){
        detenerAuto();
        finalizarPartida();
        return;
    }

    let min=parseInt(document.getElementById("min").value);
    let max=parseInt(document.getElementById("max").value);
    let modo=document.getElementById("modo").value;

    let valores=[];
    let mayor=-Infinity;

    for(let i=0;i<jugadores.length;i++){
        let v=rand(min,max);
        valores.push(v);
        if(v>mayor) mayor=v;
    }

    let ganadores=[];
    valores.forEach((v,i)=>{
        if(v===mayor){
            puntos[i]++;
            ganadores.push(i);
        }
    });

    ultimoGanador=ganadores[0];
    rondas++;

    let fila=document.createElement("div");
    valores.forEach((v,i)=>{
        let span=document.createElement("span");
        span.style.color=colores[i];
        span.textContent=jugadores[i]+":"+v+" ";
        if(v===mayor) span.style.fontWeight="bold";
        fila.appendChild(span);
    });

    document.getElementById("tabla").appendChild(fila);
    document.getElementById("tabla").scrollTop=99999;

    actualizarInfo();
    dibujarGrafica();
}

function actualizarInfo(){
    let texto="Rondas: "+rondas+" | ";
    let maxP=Math.max(...puntos);
    let lideres=[];

    puntos.forEach((p,i)=>{
        texto+=jugadores[i]+":"+p+" ";
        if(p===maxP) lideres.push(jugadores[i]);
    });

    document.getElementById("info").innerText=texto;
    document.getElementById("lider").innerText="Lider: "+lideres.join(", ");

    if(mostrarProb){
        let probTexto="";
        puntos.forEach((p,i)=>{
            let pr=rondas>0?((p/rondas)*100).toFixed(1):0;
            probTexto+=jugadores[i]+": "+pr+"% ";
        });
        document.getElementById("prob").innerText=probTexto;
    }
}

function mensajeRonda(){
    if(ultimoGanador===null) return;
    let texto=document.getElementById("textoGanador").value;
    document.getElementById("mensaje").innerText=
        jugadores[ultimoGanador]+" "+texto+" la ronda";
}

function finalizarPartida(){
    let maxP=Math.max(...puntos);
    let ganador=puntos.indexOf(maxP);
    let texto=document.getElementById("textoGanador").value;

    document.getElementById("mensaje").innerText=
        jugadores[ganador]+" "+texto+" la partida";
}

function iniciarAuto(){
    if(intervalo) return;
    let vel=parseInt(document.getElementById("velocidad").value);
    intervalo=setInterval(agregarRonda,vel);
}

function detenerAuto(){
    clearInterval(intervalo);
    intervalo=null;
}

function toggleProb(){
    mostrarProb=!mostrarProb;
    document.getElementById("prob").style.display=
        mostrarProb?"block":"none";
    actualizarInfo();
}

function modoTorneo(){
    if(jugadores.length<=1) return;
    agregarRonda();

    let minP=Math.min(...puntos);
    let eliminado=puntos.indexOf(minP);

    document.getElementById("mensaje").innerText=
        jugadores[eliminado]+" eliminado";

    jugadores.splice(eliminado,1);
    puntos.splice(eliminado,1);
    colores.splice(eliminado,1);

    configurarTorneoInputs();
}

function configurarTorneoInputs(){
    let cont=document.getElementById("nombres");
    cont.innerHTML="";
    jugadores.forEach((j,i)=>{
        let input=document.createElement("input");
        input.value=j;
        input.oninput=(e)=>jugadores[i]=e.target.value;
        cont.appendChild(input);
    });
}

function dibujarGrafica(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    let maxP=Math.max(...puntos,1);
    let ancho=canvas.width/jugadores.length;

    puntos.forEach((p,i)=>{
        let alto=(p/maxP)*canvas.height;
        ctx.fillStyle=colores[i];
        ctx.fillRect(i*ancho,canvas.height-alto,ancho-4,alto);
    });
}

function reset(){
    detenerAuto();
    configurar();
}

configurar();
</script>
